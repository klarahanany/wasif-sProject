<%- include('partials/header'); -%>

    <form action="/signup">
        <h2>Sign up</h2>

        <label for="username">Username</label>
        <input type="text" name="username" required />
        <div class="username error"></div>
        <label for="firstname">First Name</label>
        <input type="text" name="firstname" required />
        <label for="lastname">Last Name</label>
        <input type="text" name="lastname" required />
        <label for="email">Email</label>
        <input type="text" name="email" required />
        <div class="email error"></div>
        <label for="birthday">Birthday:</label>
        <input type="date" id="birthday" name="birthday" required>
        <div class="birthday error"></div>
        <label for="password">Password</label>
        <input type="password" name="password" required />
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" name="confirmPassword" required />
        <div class="password error"></div>
        <button>Sign up</button>
    </form>

    <%- include('partials/footer'); -%>

        <script>
            const form = document.querySelector('form');
            const emailError = document.querySelector('.email.error')
            const passwordError = document.querySelector('.password.error')
            const usernameError = document.querySelector('.username.error')
            const birthdayError = document.querySelector('.birthday.error')
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                //reset errors
                emailError.textContent = ''
                passwordError.textContent = ''
                usernameError.textContent = ''
                birthdayError.textContent = ''
                // get values
                const username = form.username.value;
                const email = form.email.value;
                const password = form.password.value;
                const firstname = form.firstname.value;
                const lastname = form.lastname.value;
                const birthday = form.birthday.value;
                if (!isDateBeforeToday(birthday)) {
                    birthdayError.textContent = "Choose Relevant Birthday "
                }
                else {
                    //api call from frontend to server, sending data from form to server to save in db
                    const res = await fetch('/signup', {
                        method: 'POST',
                        body: JSON.stringify({ username, email, password, firstname, lastname, birthday }),
                        headers: { 'Content-type': 'application/json' }
                    })

                    //after getting response from the server
                    const data = await res.json()
                    if (data.error) {
                        // passwordError.textContent = data.error.password
                        usernameError.textContent = data.error.username
                        emailError.textContent = data.error.email

                    }
                    if (data.user) {
                        location.assign('/')
                    }
                    if (data.status) {
                        birthdayError.textContent = data.status
                    }
                    console.log(data)

                }
            });
            function isDateBeforeToday(dateString) {
                // Parse the provided date string into a Date object
                const providedDate = new Date(dateString);

                // Get the current date
                const currentDate = new Date();

                // Set hours, minutes, seconds, and milliseconds to 0 for both dates
                providedDate.setHours(0, 0, 0, 0);
                currentDate.setHours(0, 0, 0, 0);

                // Compare the two dates
                return providedDate <= currentDate;
            }

        </script>